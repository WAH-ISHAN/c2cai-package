class C2CAIAssistant{constructor(t){this.config={backendUrl:"/api/ask",language:"en-US",persona:"general_assistant",welcomeMessage:!1,...t};const n=window.SpeechRecognition||window.webkitSpeechRecognition;n?(this.recognition=new n,this.isListening=!1,this.initUI(),this.initSpeechAPI(),this.config.welcomeMessage&&window.addEventListener("load",()=>{setTimeout(()=>{this.greetUser()},1e3)})):console.error("C2C-AI Error: Speech Recognition API is not supported in this browser.")}initUI(){const t=document.createElement("style");t.innerHTML="\n            #c2cai-container { position: fixed; bottom: 20px; right: 20px; z-index: 9999; }\n            #c2cai-button { width: 60px; height: 60px; border-radius: 50%; background-color: #007bff; border: none; cursor: pointer; display: flex; justify-content: center; align-items: center; box-shadow: 0 4px 8px rgba(0,0,0,0.2); transition: all 0.3s ease; }\n            #c2cai-button:hover { transform: scale(1.1); }\n            #c2cai-mic-icon { width: 28px; height: 28px; fill: white; }\n            #c2cai-button.listening { background-color: #dc3545; animation: pulse 1.5s infinite; }\n            #c2cai-button.thinking { background-color: #ffc107; animation: spin 1s linear infinite; }\n            #c2cai-button.speaking { pointer-events: none; } /* Disable button while speaking */\n            @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7); } 70% { box-shadow: 0 0 0 20px rgba(220, 53, 69, 0); } 100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); } }\n            @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }\n        ",document.head.appendChild(t),this.container=document.createElement("div"),this.container.id="c2cai-container",this.button=document.createElement("button"),this.button.id="c2cai-button",this.button.innerHTML='\n            <svg id="c2cai-mic-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">\n                <path d="M192 0C139 0 96 43 96 96V256c0 53 43 96 96 96s96-43 96-96V96c0-53-43-96-96-96zM64 216c0-20.8 12.3-38.7 30-46.3V256c0 70.7 57.3 128 128 128s128-57.3 128-128V169.7c17.7 7.6 30 25.5 30 46.3v40c0 6.1-1.3 12-3.8 17.4l-33.3 69.4c-3 6.2-9.4 10.2-16.4 10.2H123.5c-7 0-13.4-4-16.4-10.2L74.8 313.4c-2.5-5.4-3.8-11.3-3.8-17.4v-40zM128 448H256c17.7 0 32 14.3 32 32s-14.3 32-32 32H128c-17.7 0-32-14.3-32-32s14.3-32 32-32z"/>\n            </svg>\n        ',this.container.appendChild(this.button),document.body.appendChild(this.container),this.button.addEventListener("click",()=>this.toggleListening())}initSpeechAPI(){this.recognition.lang=this.config.language,this.recognition.interimResults=!1,this.recognition.onstart=()=>{this.isListening=!0,this.setState("listening")},this.recognition.onend=()=>{this.isListening=!1,this.button.classList.contains("thinking")||this.button.classList.contains("speaking")||this.setState("idle")},this.recognition.onresult=t=>{const n=t.results[0][0].transcript;this.setState("thinking"),this.sendToBackend(n)},this.recognition.onerror=t=>{console.error("Speech Recognition Error:",t.error),this.isListening=!1,this.setState("idle")}}toggleListening(){if(window.speechSynthesis.speaking)return window.speechSynthesis.cancel(),void this.setState("idle");this.isListening?this.recognition.stop():this.recognition.start()}setState(t){this.button.className="c2cai-button","listening"!==t&&"thinking"!==t&&"speaking"!==t||this.button.classList.add(t)}async sendToBackend(t){try{const n=document.body.innerText,e=await fetch(this.config.backendUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:t,context:n.substring(0,15e3),persona:this.config.persona})});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const i=await e.json();this.speak(i.reply)}catch(t){console.error("C2C-AI Error:",t),this.speak("I'm sorry, I encountered an error. Please try again.")}}speak(t){window.speechSynthesis.cancel(),this.setState("speaking");const n=new SpeechSynthesisUtterance(t);n.lang=this.config.language,n.onend=()=>{this.setState("idle")},window.speechSynthesis.speak(n)}greetUser(){const t=(new Date).getHours();let n;n=t<12?"Good morning":t<18?"Good afternoon":"Good evening";const e=`${n}, welcome to ${document.title||"this website"}. I am your AI assistant. How can I help you today?`;this.speak(e)}}window.C2CAIAssistant=C2CAIAssistant;